Version 4
SHEET 1 2052 1520
WIRE -272 -80 -288 -80
WIRE -112 -80 -128 -80
WIRE -112 -48 -112 -80
WIRE 448 -48 352 -48
WIRE 608 -48 512 -48
WIRE -288 -32 -288 -80
WIRE 1392 32 1296 32
WIRE 1584 32 1456 32
WIRE -112 48 -112 32
WIRE -32 48 -112 48
WIRE 0 48 -32 48
WIRE -288 64 -288 32
WIRE -112 64 -112 48
WIRE 352 64 352 -48
WIRE 432 64 352 64
WIRE 608 64 608 -48
WIRE 608 64 512 64
WIRE -32 80 -32 48
WIRE 1536 112 1504 112
WIRE -112 160 -112 144
WIRE -32 160 -32 144
WIRE -16 160 -32 160
WIRE 432 160 416 160
WIRE 496 160 432 160
WIRE 560 160 496 160
WIRE 1536 160 1536 112
WIRE 496 176 496 160
WIRE 560 176 560 160
WIRE 1296 176 1296 32
WIRE 1408 176 1296 176
WIRE 1504 176 1408 176
WIRE 1584 192 1584 32
WIRE 1584 192 1568 192
WIRE 1600 192 1584 192
WIRE 1632 192 1600 192
WIRE 1744 192 1712 192
WIRE 1824 192 1808 192
WIRE 1888 192 1824 192
WIRE 1504 208 1472 208
WIRE 1824 240 1824 192
WIRE 432 272 432 160
WIRE 1536 272 1536 224
WIRE 1600 272 1600 192
WIRE -176 288 -224 288
WIRE -80 288 -112 288
WIRE 32 288 -80 288
WIRE 96 288 32 288
WIRE 192 288 160 288
WIRE 304 288 272 288
WIRE 352 288 352 64
WIRE 352 288 304 288
WIRE 400 288 352 288
WIRE 544 304 464 304
WIRE 608 304 608 64
WIRE 608 304 544 304
WIRE 640 304 608 304
WIRE 864 304 704 304
WIRE 1088 304 864 304
WIRE 1488 304 1088 304
WIRE 400 320 368 320
WIRE 1088 320 1088 304
WIRE 1488 320 1488 304
WIRE -224 368 -224 288
WIRE 32 368 32 288
WIRE -80 400 -80 288
WIRE 992 416 944 416
WIRE 1088 416 1088 400
WIRE 1088 416 992 416
WIRE 1088 432 1088 416
WIRE 1488 432 1488 400
WIRE 944 448 944 416
WIRE 1296 464 1296 176
WIRE 1312 464 1296 464
WIRE 1200 480 1136 480
WIRE 1312 480 1312 464
WIRE 1408 480 1376 480
WIRE 1440 480 1408 480
WIRE 1280 496 1280 480
WIRE 1296 496 1296 464
WIRE 1296 496 1280 496
WIRE -224 528 -224 448
WIRE -80 528 -80 464
WIRE -80 528 -224 528
WIRE 32 528 32 448
WIRE 32 528 -80 528
WIRE 432 528 432 336
WIRE 432 528 32 528
WIRE 1824 528 1824 320
WIRE -224 544 -224 528
WIRE 944 560 944 512
WIRE 992 560 944 560
WIRE 1088 560 1088 528
WIRE 1088 560 992 560
WIRE 1088 576 1088 560
WIRE 1296 576 1296 496
WIRE 1488 576 1488 528
WIRE 1088 672 1088 656
WIRE 1296 672 1296 656
WIRE 1296 672 1088 672
WIRE 1488 672 1488 656
WIRE 1488 672 1296 672
WIRE 1600 672 1600 272
WIRE 1600 672 1488 672
FLAG 1888 192 OUT
IOPIN 1888 192 Out
FLAG -288 64 0
FLAG 304 288 A_INV
FLAG -224 544 0
FLAG 544 304 A_OUT
FLAG -224 288 PIEZO
FLAG 416 160 9V
IOPIN 416 160 In
FLAG 496 240 0
FLAG 560 240 0
FLAG 0 48 4V5
IOPIN 0 48 Out
FLAG -112 160 0
FLAG -32 160 0
FLAG -128 -80 9V
IOPIN -128 -80 In
FLAG 32 288 Cp-Cin
FLAG -272 -80 9V
IOPIN -272 -80 Out
FLAG 368 320 4V5
IOPIN 368 320 In
FLAG 1824 528 0
FLAG 1536 272 0
FLAG 1504 112 9V
IOPIN 1504 112 In
FLAG 1472 208 4V5
IOPIN 1472 208 In
FLAG 864 304 BAX_IN
FLAG 992 416 BA_3
FLAG 992 560 BA_1
FLAG 1408 480 TR_2
FLAG 1408 176 BAX_A_INV
FLAG 1600 272 BAX_A_OUT
SYMBOL Res 528 48 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rf
SYMATTR Value {Rf}
SYMBOL Cap 512 -64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cf
SYMATTR Value {Cf}
SYMBOL Cap -112 272 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cpiezo
SYMATTR Value {Cpiezo}
SYMBOL Cap 704 288 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cmid
SYMATTR Value {Cmid}
SYMBOL voltage -224 352 R0
WINDOW 0 -96 10 Left 2
WINDOW 3 -193 103 Left 2
WINDOW 123 -190 135 Left 2
SYMATTR InstName Vpiezo
SYMATTR Value SINE(0 1000m 1k)
SYMATTR Value2 AC 1
SYMBOL Res 1808 224 R0
SYMATTR InstName Rvol
SYMATTR Value 10k
SYMBOL Opamps/opamp2 432 240 R0
WINDOW 0 22 99 Left 2
WINDOW 3 24 128 Left 2
SYMATTR InstName U1
SYMATTR Value OPAx145
SYMBOL Cap 480 176 R0
WINDOW 0 -28 11 Left 2
WINDOW 3 -27 49 Left 1
SYMATTR InstName Cb1
SYMATTR Value 100n
SYMBOL Cap 544 176 R0
WINDOW 0 -28 11 Left 2
WINDOW 3 -15 51 Left 1
SYMATTR InstName Cb2
SYMATTR Value 10µ
SYMBOL Res 16 352 R0
WINDOW 0 35 72 Left 2
WINDOW 3 22 103 Left 2
SYMATTR InstName Rfix
SYMATTR Value 100Meg
SYMBOL Cap 160 272 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cin
SYMATTR Value 10µ
SYMBOL Res -128 -64 R0
SYMATTR InstName R1
SYMATTR Value 47k
SYMBOL Res -128 48 R0
WINDOW 3 33 87 Left 2
SYMATTR Value 47k
SYMATTR InstName R2
SYMBOL Cap -48 80 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL Misc/cell -288 -32 R0
SYMATTR InstName Vbatt
SYMATTR Value 9
SYMBOL Res 1728 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rout
SYMATTR Value 100
SYMBOL Res 288 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rin
SYMATTR Value 70
SYMBOL Cap -96 400 R0
WINDOW 0 24 10 Left 2
SYMATTR InstName Ccable
SYMATTR Value 2n
SYMBOL Res 1072 304 R0
SYMATTR InstName Rb1
SYMATTR Value 3.9k
SYMBOL Res 1072 560 R0
SYMATTR InstName Rb2
SYMATTR Value 3.9k
SYMBOL Cap 928 448 R0
WINDOW 0 -25 8 Left 2
WINDOW 3 -41 54 Left 2
SYMATTR InstName Cb
SYMATTR Value {Cb}
SYMBOL Res 1296 464 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 3.9k
SYMBOL Cap 1376 464 R90
WINDOW 0 -2 34 VBottom 2
WINDOW 3 32 30 VTop 2
SYMATTR InstName Ct
SYMATTR Value {Ct}
SYMBOL Res 1472 304 R0
SYMATTR InstName Rt1
SYMATTR Value 2k2
SYMBOL Res 1472 560 R0
SYMATTR InstName Rt2
SYMATTR Value 2k2
SYMBOL Opamps/opamp2 1536 128 R0
WINDOW 0 -59 110 Left 2
WINDOW 3 -129 133 Left 2
SYMATTR InstName U2
SYMATTR Value OPAx145
SYMBOL Res 1280 560 R0
SYMATTR InstName R8
SYMATTR Value 10Meg
SYMBOL Cap 1808 176 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cout1
SYMATTR Value 100µ
SYMBOL linearpot 1088 432 R180
WINDOW 0 32 -18 Left 2
WINDOW 39 29 -44 Left 2
WINDOW 40 26 -68 Left 2
SYMATTR InstName U3
SYMATTR SpiceLine R=10k
SYMATTR SpiceLine2 w={wb}
SYMBOL linearpot 1488 432 M180
WINDOW 0 29 -76 Left 2
WINDOW 40 30 -27 Left 2
SYMATTR InstName U4
SYMATTR SpiceLine2 w={wt}
SYMATTR SpiceLine R=10k
SYMBOL Cap 1456 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cstab
SYMATTR Value 100p
TEXT -256 688 Left 2 ;.tran 2000u
TEXT -8 560 Left 1 ;Rfix is needed, otherwise Cp-Cin\nis a floating node - 2 caps in series \nis a problem in LTSpice, as they \ncannot discharge
TEXT 272 656 Left 2 !.inc ./OPAx145.LIB
TEXT -256 656 Left 2 ;.op
TEXT 32 -184 Left 4 ;Piezo Charge Amplifier
TEXT -256 720 Left 2 !.ac dec 100 10 10Meg
TEXT 272 688 Left 2 !.inc ./OPAx134.LIB
TEXT -256 752 Left 2 ;.noise V(out) Vpiezo dec 100 20 100k
TEXT -256 832 Left 2 ;.step param Cpiezo list 1n 10n 20n 40n 100n
TEXT -256 944 Left 2 ;.step param Cf list 1n 5.7n 11n 23n
TEXT -256 1056 Left 2 ;.step param Rf list 50k 5Meg
TEXT -256 800 Left 2 ;# piezo capacitances: e.g. 1n, 10n, 20n, 40n, 100n (2x big)
TEXT -256 912 Left 2 ;# available feedback caps: 1n, 5.7n, 11n, 23n
TEXT -256 1024 Left 2 ;# Rf with Cf form a LPF
TEXT 192 408 Left 1 ;using protective diodes\non A_INV (not used here)\ncan cause stability issues \n- always verify and place \nthem in front of Rin
TEXT 160 208 Left 1 ;Rin required for stability.\nWill use 2x150R in design.
TEXT 1648 72 Left 1 ;Rout helps drive output\ncable capacitance.\n68R in design.
TEXT -256 864 Left 2 !.param Cpiezo 23n
TEXT -256 976 Left 2 !.param Cf 23n
TEXT -256 1088 Left 2 !.param Rf 10Meg
TEXT 272 720 Left 2 !.inc linearpot.LIB
TEXT 1152 792 Left 2 !.step param wb list 0 0.5 1
TEXT 1152 952 Left 2 !.step param wt list 0 0.5 1
TEXT 1152 824 Left 2 ;.param wb 0.5
TEXT 1152 984 Left 2 ;.param wt 0.5
TEXT 1152 720 Left 2 ;# Bass linear potentiometer\n# wb = 0 = max cut\n# wb = 1 = max boost
TEXT 1152 880 Left 2 ;# Treble linear potentiometer\n# wt = 0 = max cut\n# wt = 1 = max boost
TEXT 600 792 Left 2 ;.step param Cmid list 288n 508n 728n 10u
TEXT 600 824 Left 2 !.param Cmid 10u
TEXT 600 720 Left 2 ;# Low-pass cutoff cap\n# 288n = 237Hz, 508n = 121Hz, \n# 728n = 75Hz, 100u = full
TEXT 1152 1040 Left 2 ;# Center switch - DP4T moving the center of Bax TC\n# by swapping Cb and Ct caps at the same time
TEXT 1152 1096 Left 2 ;.step param center list 1 2 3 4
TEXT 1152 1128 Left 2 !.param center 1
TEXT 1152 1160 Left 2 !.param Cb table(center, 1, 168n, 2, 136n, 3, 90n, 4, 68n)
TEXT 1152 1192 Left 2 !.param Ct table(center, 1, 28.8n, 2, 13.6n, 3, 11.5n, 4, 6.8n)
TEXT -248 1168 Left 2 ;# Noise calculations (see Error Log)\n#\n# Worst case: Cpiezo = 100n, Cf = 1n, Cmid = 100u, wb = 0.5, wt = 1, center = 1: \n# Vnoise_rms = 369uV integrated over 20Hz - 100kHz range\n# Vnoise_pp = 6.6 * 369uV = 2.44mV\n#\n# Normal case: Cpiezo = 40n, Cf = 11n, Cmid = 100u, wb = 0.5, wt = 1, center = 1:\n# Vnoise_rms = 31uV\n# Vnoise_pp = 0.2mV
TEXT -248 1376 Left 2 !.meas NOISE Vnoise_rms integ V(onoise) from 20 to 100k
TEXT -248 1408 Left 2 !.meas NOISE Vnoise_pp param Vnoise_rms*6.6*1000
